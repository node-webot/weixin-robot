#!/usr/bin/env node

var prettyjson = require('prettyjson');
var color = require('color');
// Send test text message
var readline = require('readline');
var fs = require('fs');

var bootstrap = require('../test/bootstrap');
var makeQ = bootstrap.makeAuthQuery;
var request = bootstrap.request;
var xml2json = bootstrap.xml2json;

var rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

var text_msg = fs.readFileSync(__dirname + '/../test/wx_geo.xml', 'utf-8');

function run() {
  rl.question('x: ', function(text) {
    var text = text || '23.08';
    var t = text_msg.replace('{x}', text);
    rl.question('y:', function(text) {
      var text = text || '113.24';
      var req = request.build('POST http://127.0.0.1:3000/', makeQ(), function(err, ret) {
        var xml;
        try {
          xml = JSON.parse(xml2json.toJson(ret)).xml;
        } catch (e) {
          console.log(err, ret);
        }
        var xml = JSON.parse(xml2json.toJson(ret)).xml;
        console.log(prettyjson.render(xml));
        console.log('\n');
        run();
      });
      req.write(t.replace('{y}', text));
      req.end();
    });
  });
}

run();
